{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="step-indicator">
            <div class="step completed">
                <div class="number">1</div>
                <div class="label">需求分析</div>
            </div>
            <div class="step completed">
                <div class="number">2</div>
                <div class="label">AHP评估</div>
            </div>
            <div class="step completed">
                <div class="number">3</div>
                <div class="label">提示词生成</div>
            </div>
            <div class="step completed">
                <div class="number">4</div>
                <div class="label">概念筛选</div>
            </div>
            <div class="step active">
                <div class="number">5</div>
                <div class="label">设计评估</div>
            </div>
        </div>

        <h2>基于GRA-TOPSIS的定量评估</h2>
        <p class="text-muted">按照文档公式：灰色关联分析(GRA) + 理想解排序法(TOPSIS)</p>

        <!-- 评分录入 -->
        <div class="card">
            <div class="card-header">
                <h5>Step 1: 评分录入（使用文档中的16个指标）</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-clipboard-check"></i> 请对3个备选方案进行评分（0-10分，使用文档表7的评分标准）
                </div>
                
                <div id="schemesInfo" class="mb-4">
                    {% if concepts %}
                        <div class="row">
                            {% for concept in concepts %}
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h6>{{ concept.title }}</h6>
                                            <p class="small text-muted">{{ concept.description }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div id="evaluationTable">
                    <!-- 使用文档中的16个指标 -->
                </div>
            </div>
        </div>

        <!-- 算法公式展示 -->
        <div class="card mt-4" id="formulasCard" style="display: none;">
            <div class="card-header bg-info text-white">
                <h5>算法公式说明</h5>
            </div>
            <div class="card-body">
                <div class="accordion" id="formulasAccordion">
                    <!-- AHP公式 -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAHP">
                                <strong>层次分析法(AHP)公式</strong>
                            </button>
                        </h2>
                        <div id="collapseAHP" class="accordion-collapse collapse show" data-bs-parent="#formulasAccordion">
                            <div class="accordion-body">
                                <h6>1. 几何平均法计算权重：</h6>
                                <p class="formula">w_i = (∏_{j=1}^n a_{ij})^{1/n} / Σ_{k=1}^n (∏_{j=1}^n a_{kj})^{1/n}</p>
                                
                                <h6>2. 最大特征值：</h6>
                                <p class="formula">λ_max = (1/n) × Σ_{i=1}^n (Σ_{j=1}^n a_{ij}w_j) / w_i</p>
                                
                                <h6>3. 一致性检验：</h6>
                                <p class="formula">CI = (λ_max - n) / (n - 1)</p>
                                <p class="formula">CR = CI / RI</p>
                                <p><em>当 CR < 0.1 时通过一致性检验</em></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GRA公式 -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGRA">
                                <strong>灰色关联分析(GRA)公式</strong>
                            </button>
                        </h2>
                        <div id="collapseGRA" class="accordion-collapse collapse" data-bs-parent="#formulasAccordion">
                            <div class="accordion-body">
                                <h6>1. 无量纲化处理（平方和归一化）：</h6>
                                <p class="formula">c_{ij} = X_{ij} / √(Σ_{i=1}^m X_{ij}^2)</p>
                                
                                <h6>2. 加权规范化决策矩阵：</h6>
                                <p class="formula">d_{ij} = c_{ij} × w_j</p>
                                
                                <h6>3. 参考序列：</h6>
                                <p class="formula">d_{0k} = max(d_{ik})</p>
                                
                                <h6>4. 关联系数：</h6>
                                <p class="formula">ζ_i(k) = (min_i min_k Δ_i(k) + ρ·max_i max_k Δ_i(k)) / (Δ_i(k) + ρ·max_i max_k Δ_i(k))</p>
                                <p>其中：Δ_i(k) = |d_{0k} - d_{ik}|，ρ=0.5（分辨系数）</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TOPSIS公式 -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTOPSIS">
                                <strong>理想解排序法(TOPSIS)公式</strong>
                            </button>
                        </h2>
                        <div id="collapseTOPSIS" class="accordion-collapse collapse" data-bs-parent="#formulasAccordion">
                            <div class="accordion-body">
                                <h6>1. 正负理想解：</h6>
                                <p class="formula">ζ_0^+ = {max ζ_i(k) | k = 1,2,...,m}</p>
                                <p class="formula">ζ_0^- = {min ζ_i(k) | k = 1,2,...,n}</p>
                                
                                <h6>2. 距离计算：</h6>
                                <p class="formula">l_i^+ = √(Σ_{k=1}^m (ζ_i(k) - ζ_0^+(k))^2)</p>
                                <p class="formula">l_i^- = √(Σ_{k=1}^n (ζ_i(k) - ζ_0^-(k))^2)</p>
                                
                                <h6>3. 相对贴近度：</h6>
                                <p class="formula">U_i^+ = l_i^- / (l_i^+ + l_i^-)</p>
                                
                                <h6>4. 综合评判：</h6>
                                <p class="formula">F = W × U</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 计算结果 -->
        <div class="card mt-4" id="calculationResult" style="display: none;">
            <div class="card-header">
                <h5>Step 2: 评估结果与计算过程</h5>
            </div>
            <div class="card-body">
                <div id="topsisResults"></div>
                <div id="calculationDetails" class="mt-4"></div>
            </div>
        </div>

        <!-- 方案优化 -->
        <div class="card mt-4" id="optimizationCard" style="display: none;">
            <div class="card-header">
                <h5>Step 3: 方案优化建议</h5>
            </div>
            <div class="card-body">
                <div id="optimizationSuggestions"></div>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="showOptimizationForm()">修改提示词进行迭代优化</button>
                </div>
            </div>
        </div>

        <!-- 优化表单 -->
        <div class="card mt-4" id="optimizationForm" style="display: none;">
            <div class="card-header">
                <h5>提示词优化</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">针对短板维度补充优化参数</label>
                    <textarea class="form-control" id="optimizationParams" rows="3" 
                              placeholder="例如：加强隐私性设计，优化环境适应性..."></textarea>
                </div>
                <button class="btn btn-success" onclick="submitOptimization()">开始优化迭代</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 使用文档中的16个评估指标
const criteria = [
    // 功能性（4个）
    '模块化程度', '智能化水平', '集成化程度', '可扩展性',
    // 隐私性（4个）
    '数据安全性', '访问控制', '信息保密性', '物理隔离性',
    // 人性化（4个）
    '可达性', '易用性', '舒适性', '情感化设计',
    // 环境适应性（4个）
    '气候适应性', '地形适应性', '能源适应性', '空间适应性'
];

// 文档中的权重（归一化）
const weights = [
    // 功能性权重
    0.47236 * 0.4866, 0.47236 * 0.0848, 0.47236 * 0.1213, 0.47236 * 0.3073,
    // 隐私性权重
    0.08233 * 0.0996, 0.08233 * 0.3820, 0.08233 * 0.4320, 0.08233 * 0.0864,
    // 人性化权重
    0.22789 * 0.4573, 0.22789 * 0.1052, 0.22789 * 0.1377, 0.22789 * 0.2998,
    // 环境适应性权重
    0.21743 * 0.4444, 0.21743 * 0.1597, 0.21743 * 0.1597, 0.21743 * 0.2361
];

// 所有指标都是效益型
const impacts = Array(criteria.length).fill('+');

let evaluationData = {
    criteria: criteria,
    weights: weights,
    impacts: impacts
};

// 工具函数对象 - 定义在最前面
const Utils = {
    showAlert: function(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.querySelector('.container').prepend(alertDiv);
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    },
    
    formatNumber: function(num) {
        const numValue = parseFloat(num);
        return isNaN(numValue) ? '0.00' : numValue.toFixed(2);
    }
};

// 页面加载时初始化
document.addEventListener('DOMContentLoaded', function() {
    generateEvaluationTable();
    document.getElementById('formulasCard').style.display = 'block';
});

function generateEvaluationTable() {
    const tableDiv = document.getElementById('evaluationTable');
    
    // 分组显示指标
    const groups = [
        { name: '功能性', indices: [0, 1, 2, 3] },
        { name: '隐私性', indices: [4, 5, 6, 7] },
        { name: '人性化', indices: [8, 9, 10, 11] },
        { name: '环境适应性', indices: [12, 13, 14, 15] }
    ];
    
    let html = `
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2">评估指标</th>
                        <th colspan="3" class="text-center">方案评分 (0-10分)</th>
                        <th rowspan="2">权重</th>
                    </tr>
                    <tr>
                        <th>方案 P1</th>
                        <th>方案 P2</th>
                        <th>方案 P3</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    groups.forEach(group => {
        html += `<tr class="table-group"><th colspan="5">${group.name}</th></tr>`;
        
        group.indices.forEach(index => {
            html += `<tr>
                <td>${criteria[index]}</td>`;
            
            // 为每个方案生成评分输入
            for (let i = 0; i < 3; i++) {
                html += `
                    <td>
                        <input type="number" class="form-control" 
                               name="scores[${i}][${index}]" 
                               min="0" max="10" step="0.5" value="5.5">
                    </td>
                `;
            }
            
            html += `<td class="text-center">${(weights[index] * 100).toFixed(2)}%</td></tr>`;
        });
    });
    
    html += `
                </tbody>
            </table>
        </div>
        <div class="text-end mt-3">
            <button class="btn btn-primary" onclick="calculateEvaluation()">
                <i class="bi bi-calculator"></i> 计算GRA-TOPSIS评估结果
            </button>
        </div>
    `;
    
    tableDiv.innerHTML = html;
}

async function calculateEvaluation() {
    // 收集评分数据
    const scores = [];
    let hasInvalidInput = false;
    
    for (let i = 0; i < 3; i++) {
        const schemeScores = [];
        for (let j = 0; j < criteria.length; j++) {
            const input = document.querySelector(`input[name="scores[${i}][${j}]"]`);
            const value = parseFloat(input.value);
            
            if (isNaN(value) || value < 0 || value > 10) {
                input.classList.add('is-invalid');
                hasInvalidInput = true;
                schemeScores.push(5.5);
            } else {
                input.classList.remove('is-invalid');
                schemeScores.push(value);
            }
        }
        scores.push(schemeScores);
    }
    
    if (hasInvalidInput) {
        Utils.showAlert('请确保所有评分都在0-10分之间', 'warning');
        return;
    }
    
    try {
        const response = await fetch('{{ url_for("design_evaluation") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                scores: scores,
                weights: evaluationData.weights,
                impacts: evaluationData.impacts
            })
        });
        
        const result = await response.json();
        
        if (!result.scores || result.scores.length === 0) {
            throw new Error('计算结果为空');
        }
        
        displayResults(result);
    } catch (error) {
        console.error('计算失败:', error);
        Utils.showAlert('计算失败：' + error.message, 'danger');
    }
}

function displayResults(result) {
    const container = document.getElementById('topsisResults');
    
    // 验证结果
    if (!result || !result.scores || result.scores.length !== 3) {
        container.innerHTML = '<div class="alert alert-danger">计算结果格式错误</div>';
        document.getElementById('calculationResult').style.display = 'block';
        return;
    }
    
    // 生成排名和分数
    let html = `
        <h6>方案排名结果：</h6>
        <div class="row mt-3">
    `;
    
    // 按排名顺序显示
    result.rank.forEach((schemeIndex, rank) => {
        const score = result.scores[schemeIndex];
        html += `
            <div class="col-md-4 mb-3">
                <div class="card ${rank === 0 ? 'border-success' : ''}">
                    <div class="card-body text-center">
                        <h5>第${rank + 1}名：方案 P${schemeIndex + 1}</h5>
                        <div class="display-4 ${rank === 0 ? 'text-success' : 'text-primary'}">
                            ${Utils.formatNumber(score)}
                        </div>
                        <div class="small text-muted">相对贴近度</div>
                        <div class="mt-2">
                            <span class="badge ${rank === 0 ? 'bg-success' : 'bg-secondary'}">
                                ${result.closeness[schemeIndex].toFixed(4)}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += `</div>`;
    
    // 添加图表
    html += `
        <div class="mt-4">
            <h6>方案对比图</h6>
            <canvas id="resultsChart" width="400" height="200"></canvas>
        </div>
    `;
    
    container.innerHTML = html;
    
    // 绘制图表
    const ctx = document.getElementById('resultsChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['方案 P1', '方案 P2', '方案 P3'],
            datasets: [{
                label: 'GRA-TOPSIS评分',
                data: result.scores,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(75, 192, 192, 0.7)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(75, 192, 192, 1)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: '评分 (%)'
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `评分: ${Utils.formatNumber(context.raw)}%`;
                        }
                    }
                },
                legend: {
                    display: true,
                    position: 'top'
                }
            }
        }
    });
    
    // 显示计算详情
    displayCalculationDetails(result);
    
    // 显示结果卡片
    document.getElementById('calculationResult').style.display = 'block';
    document.getElementById('calculationResult').scrollIntoView({ behavior: 'smooth' });
    
    // 生成优化建议
    generateOptimizationSuggestions(result.scores, result.rank);
}

function displayCalculationDetails(result) {
    const container = document.getElementById('calculationDetails');
    
    if (!result.calculation_steps) {
        container.innerHTML = '<div class="alert alert-info">计算过程详情未提供</div>';
        return;
    }
    
    let html = `
        <h6>计算过程详情：</h6>
        <div class="accordion" id="calcDetailsAccordion">
    `;
    
    // 显示各步骤矩阵
    const steps = result.calculation_steps;
    
    // 1. 归一化矩阵
    html += `
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNorm">
                    <strong>步骤1：归一化矩阵</strong>
                </button>
            </h2>
            <div id="collapseNorm" class="accordion-collapse collapse" data-bs-parent="#calcDetailsAccordion">
                <div class="accordion-body">
                    <p><em>公式：c_{ij} = X_{ij} / √(Σ_{i=1}^m X_{ij}^2)</em></p>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>方案</th>
                                    ${criteria.map((c, i) => `<th>${c}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
    `;
    
    steps.normalized_matrix.forEach((row, i) => {
        html += `<tr><th>P${i+1}</th>`;
        row.forEach(val => {
            html += `<td>${val.toFixed(4)}</td>`;
        });
        html += `</tr>`;
    });
    
    html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // 2. 加权矩阵
    html += `
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWeighted">
                    <strong>步骤2：加权规范化矩阵</strong>
                </button>
            </h2>
            <div id="collapseWeighted" class="accordion-collapse collapse" data-bs-parent="#calcDetailsAccordion">
                <div class="accordion-body">
                    <p><em>公式：d_{ij} = c_{ij} × w_j</em></p>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>方案</th>
                                    ${criteria.map((c, i) => `<th>${c}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
    `;
    
    steps.weighted_matrix.forEach((row, i) => {
        html += `<tr><th>P${i+1}</th>`;
        row.forEach(val => {
            html += `<td>${val.toFixed(4)}</td>`;
        });
        html += `</tr>`;
    });
    
    html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // 3. 参考序列
    html += `
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRef">
                    <strong>步骤3：参考序列</strong>
                </button>
            </h2>
            <div id="collapseRef" class="accordion-collapse collapse" data-bs-parent="#calcDetailsAccordion">
                <div class="accordion-body">
                    <p><em>公式：d_{0k} = max(d_{ik})</em></p>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr><th>指标</th><th>参考值</th></tr>
                            </thead>
                            <tbody>
    `;
    
    steps.reference_sequence.forEach((val, i) => {
        html += `<tr><td>${criteria[i]}</td><td>${val.toFixed(4)}</td></tr>`;
    });
    
    html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // 4. 灰色关联系数矩阵
    html += `
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGrey">
                    <strong>步骤4：灰色关联系数矩阵</strong>
                </button>
            </h2>
            <div id="collapseGrey" class="accordion-collapse collapse" data-bs-parent="#calcDetailsAccordion">
                <div class="accordion-body">
                    <p><em>公式：ζ_i(k) = (min_i min_k Δ_i(k) + ρ·max_i max_k Δ_i(k)) / (Δ_i(k) + ρ·max_i max_k Δ_i(k))</em></p>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>方案</th>
                                    ${criteria.map((c, i) => `<th>${c}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
    `;
    
    steps.grey_relation_matrix.forEach((row, i) => {
        html += `<tr><th>P${i+1}</th>`;
        row.forEach(val => {
            html += `<td>${val.toFixed(4)}</td>`;
        });
        html += `</tr>`;
    });
    
    html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // 5. 距离计算
    html += `
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDist">
                    <strong>步骤5：距离计算</strong>
                </button>
            </h2>
            <div id="collapseDist" class="accordion-collapse collapse" data-bs-parent="#calcDetailsAccordion">
                <div class="accordion-body">
                    <p><em>公式：l_i^+ = √(Σ(ζ_i(k) - ζ_0^+(k))^2)，l_i^- = √(Σ(ζ_i(k) - ζ_0^-(k))^2)</em></p>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>正理想解距离：</h6>
                            <ul class="list-group">
    `;
    
    steps.distances_best.forEach((dist, i) => {
        html += `<li class="list-group-item d-flex justify-content-between">
            P${i+1} <span class="badge bg-primary">${dist.toFixed(4)}</span>
        </li>`;
    });
    
    html += `
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>负理想解距离：</h6>
                            <ul class="list-group">
    `;
    
    steps.distances_worst.forEach((dist, i) => {
        html += `<li class="list-group-item d-flex justify-content-between">
            P${i+1} <span class="badge bg-danger">${dist.toFixed(4)}</span>
        </li>`;
    });
    
    html += `
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    html += `</div>`;
    container.innerHTML = html;
}

function generateOptimizationSuggestions(scores, rank) {
    const suggestions = [];
    
    // 根据文档中的权重，找出需要优化的方面
    const weakAreas = [
        { criterion: '功能性', weight: 0.47236 },
        { criterion: '人性化', weight: 0.22789 },
        { criterion: '环境适应性', weight: 0.21743 },
        { criterion: '隐私性', weight: 0.08233 }
    ];
    
    rank.forEach((schemeIndex, position) => {
        const schemeName = `P${schemeIndex + 1}`;
        const score = scores[schemeIndex];
        
        let weaknesses = [];
        let suggestion = '';
        
        if (score < 70) {
            weaknesses = weakAreas.slice(0, 3).map(area => area.criterion);
            suggestion = '建议：重新设计核心功能模块，加强人性化设计，提升环境适应性';
        } else if (score < 85) {
            weaknesses = weakAreas.slice(1, 3).map(area => area.criterion);
            suggestion = '建议：优化人机交互界面，改善环境适应性能';
        } else {
            weaknesses = ['保持现有优势'];
            suggestion = '建议：微调细节，提升用户体验';
        }
        
        suggestions.push({
            scheme: schemeName,
            weaknesses: weaknesses,
            suggestion: suggestion,
            position: position + 1,
            score: score
        });
    });
    
    const container = document.getElementById('optimizationSuggestions');
    let html = '<h6>各方案优化建议：</h6>';
    
    suggestions.forEach(item => {
        html += `
            <div class="alert ${item.position === 1 ? 'alert-success' : 'alert-light'} mb-2">
                <strong>${item.scheme}（第${item.position}名，得分：${Utils.formatNumber(item.score)}%）：</strong>
                ${item.weaknesses.length > 0 ? `重点优化：${item.weaknesses.join('、')}<br>` : ''}
                <em>${item.suggestion}</em>
            </div>
        `;
    });
    
    container.innerHTML = html;
    document.getElementById('optimizationCard').style.display = 'block';
}

function showOptimizationForm() {
    document.getElementById('optimizationForm').style.display = 'block';
    document.getElementById('optimizationForm').scrollIntoView({ behavior: 'smooth' });
}

function submitOptimization() {
    const params = document.getElementById('optimizationParams').value;
    
    if (!params) {
        Utils.showAlert('请输入优化参数', 'warning');
        return;
    }
    
    Utils.showAlert('已提交优化请求，将进行迭代生成', 'success');
    
    // 模拟优化完成
    setTimeout(() => {
        Utils.showAlert('优化完成！新方案已生成，请返回概念筛选查看', 'info');
    }, 2000);
}
</script>

<style>
.formula {
    font-family: 'Cambria Math', 'Times New Roman', serif;
    font-size: 1.1em;
    color: #d63384;
    margin: 10px 0;
    padding: 5px;
    background-color: #f8f9fa;
    border-left: 4px solid #6c757d;
}

.table-group {
    background-color: #e9ecef;
    font-weight: bold;
}

.accordion-button:not(.collapsed) {
    background-color: #e7f1ff;
    color: #0d6efd;
}

.accordion-body {
    background-color: #f8f9fa;
}
</style>
{% endblock %}